<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Development of Statistical Software with A Case Study</title>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/reveal.js/3.0.0/css/reveal.css"/>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/reveal.js/3.0.0/css/theme/serif.css" id="theme"/>

<link rel="stylesheet" href="./presentation.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/reveal.js/3.0.0/lib/css/zenburn.css"/>
<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'https://cdn.jsdelivr.net/reveal.js/3.0.0/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1 class="title">Development of Statistical Software with A Case Study</h1><h2 class="date">IFRIT, 2017</h2><p class="date">Created: 2017-07-19 Wed 17:23</p>
</section>

<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgeafbbfe">
<div class="slide-header"></div>
<h3 id="orgeafbbfe">Team</h3>
<ul>
<li>Zhong Wang</li>
<li>Chenguang Wang (<i>cwang@gateofsci.com</i>)</li>

</ul>

<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgd82839f">
<div class="slide-header"></div>
<h2 id="orgd82839f">Introduction</h2>
<div class="outline-text-2" id="text-orgd82839f">
</div><div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org8598cec">
<div class="slide-header"></div>
<h3 id="org8598cec">Guide to become a researcher</h3>
<div class="outline-text-3" id="text-org8598cec">
</div><div class="slide-footer"></div>
</section>
<section id="slide-org68d3fba">
<div class="slide-header"></div>
<h4 id="org68d3fba"></h4>

<div class="figure">
<p><img src="pp_2.png" alt="pp_2.png" />
</p>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org6484023">
<div class="slide-header"></div>
<h4 id="org6484023"></h4>

<div class="figure">
<p><img src="pp_3.png" alt="pp_3.png" />
</p>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org6295b4c">
<div class="slide-header"></div>
<h4 id="org6295b4c"></h4>

<div class="figure">
<p><img src="pp_4.png" alt="pp_4.png" />
</p>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org34446b0">
<div class="slide-header"></div>
<h4 id="org34446b0"></h4>

<div class="figure">
<p><img src="pp_5.png" alt="pp_5.png" />
</p>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-orge257e51">
<div class="slide-header"></div>
<h4 id="orge257e51"></h4>

<div class="figure">
<p><img src="pp_6.png" alt="pp_6.png" />
</p>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org7c44295">
<div class="slide-header"></div>
<h4 id="org7c44295"></h4>

<div class="figure">
<p><img src="pp_7.png" alt="pp_7.png" />
</p>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-orgb43aeb1">
<div class="slide-header"></div>
<h4 id="orgb43aeb1"></h4>

<div class="figure">
<p><img src="pp_8.png" alt="pp_8.png" />
</p>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org5d190dc">
<div class="slide-header"></div>
<h4 id="org5d190dc"></h4>

<div class="figure">
<p><img src="pp_9.png" alt="pp_9.png" />
</p>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org9f0f4be">
<div class="slide-header"></div>
<h4 id="org9f0f4be"></h4>

<div class="figure">
<p><img src="pp_10.png" alt="pp_10.png" />
</p>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org1bd9350">
<div class="slide-header"></div>
<h4 id="org1bd9350"></h4>

<div class="figure">
<p><img src="pp_11.png" alt="pp_11.png" />
</p>
</div>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org44089f4">
<div class="slide-header"></div>
<h3 id="org44089f4">Steps of applied research</h3>
<ul>
<li>Identify a problem</li>
<li>Hypothesis</li>
<li>Experiments / Simulation studies</li>
<li>Conclusion</li>
<li>Applications</li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgc41cbb5">
<div class="slide-header"></div>
<h3 id="orgc41cbb5">Typical product</h3>

<div class="figure">
<p><img src="product.png" alt="product.png" />
</p>
</div>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgcb67345">
<div class="slide-header"></div>
<h3 id="orgcb67345">Challenges</h3>
<ul>
<li>Difficult to understand the algorithm</li>
<li>Difficult to understand the command line mode</li>
<li>Platform dependent</li>
<li>Rely on legacy system</li>
<li>&#x2026;</li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgf9bf089">
<div class="slide-header"></div>
<h3 id="orgf9bf089">Motivation</h3>
<p>
We believe that scientists' pioneering achievements can be better delivered
to <i>people</i> by user-friendly, customizable and extensible <i>software</i>.
</p>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org1afad77">
<div class="slide-header"></div>
<h3 id="org1afad77">Software development</h3>

<div class="figure">
<p><img src="sdlc.jpg" alt="sdlc.jpg" />
</p>
</div>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orge29c71d">
<div class="slide-header"></div>
<h3 id="orge29c71d">Overall scheme</h3>

<div class="figure">
<p><img src="sgsc.png" alt="sgsc.png" />
</p>
</div>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org8db03a3">
<div class="slide-header"></div>
<h2 id="org8db03a3">Case Study: Background</h2>
<div class="outline-text-2" id="text-org8db03a3">
</div><div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org61ebd65">
<div class="slide-header"></div>
<h3 id="org61ebd65">Motivation</h3>
<ul>
<li>Consider a <i>randomized</i> clinical study</li>
<li>Outcomes scheduled to be measured at pre-specified time points after
randomization</li>
<li><i>Goal</i>: To evaluate the efficacy of a treatment</li>
<li><i>Issue</i>: Clinical evaluations <i>unobserved</i> due to
<ul>
<li>lost to follow up</li>
<li>withdraw of consent</li>
<li>out-of-window visit</li>
<li><i>death</i></li>

</ul></li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org6e9a96c">
<div class="slide-header"></div>
<h3 id="org6e9a96c">Notation</h3>
<ul>
<li>\(T=0,1\): treatment assignment</li>
<li>\(Y_0\): baseline measure at \(t_0\)</li>
<li>\(Y_1, \ldots, Y_K\): post-randomization outcomes at \(t_1, \ldots, t_K\)</li>
<li>\(L\): survival time</li>
<li>\(A_k=I(L>t_k)\): survival status at \(t_k\)</li>
<li>\(Z=g(Y_0,\ldots,Y_K)\): primary functional endpoint
<ul>
<li>e.g. \(Z=Y_K\), \(Z=Y_K-Y_0\)</li>
<li>only defined when \(A_K=1\)</li>

</ul></li>
<li>For subjects alive at the end of the study (\(A_K=1\))
<ul>
<li>\(\tau_k\): missingness indicator of \(Y_k\) (1: observed, 0: missing)</li>
<li>\(S=(\tau_1, \ldots, \tau_K)\): missing pattern</li>
<li>\(Y_{obs}=\{Y_k: \tau_k=1, k \geq 1\}\): observed functional outcome</li>
<li>\(Y_{mis}=\{Y_k: \tau_k=0, k \geq 1\}\): missing functional outcome</li>

</ul></li>
<li>\(X\): baseline covariates</li>
<li>\(\overline{Y}_k\): \((Y_1,\ldots,Y_k)\)</li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org8ed3bbe">
<div class="slide-header"></div>
<h3 id="org8ed3bbe">Issues</h3>
<ul>
<li>Missing data</li>
<li>Death</li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgc46a892">
<div class="slide-header"></div>
<h3 id="orgc46a892">Proposal</h3>

<div class="figure">
<p><img src="subjects.png" alt="subjects.png" />
</p>
</div>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org7ebe0d4">
<div class="slide-header"></div>
<h3 id="org7ebe0d4">Steps</h3>
<div class="outline-text-3" id="text-org7ebe0d4">
</div><div class="slide-footer"></div>
</section>
<section id="slide-org7308f55">
<div class="slide-header"></div>
<h4 id="org7308f55">Imputation</h4>
<ul>
<li>Impute missing data for survivors</li>
<li>Benchmark assumption 
\[f(Y_{mis} | A_K=1,Y_{obs}, Y_0, X, T,S=s) = f(Y_{mis} | A_K=1,
       Y_{obs}, Y_0, X, T, S=\mathbf{1}) \qquad \forall s \neq \mathbf{1} \]</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-org20b625a">
<div class="slide-header"></div>
<h4 id="org20b625a">Rank all subjects</h4>
<ul>
<li>Both alive 
<ul>
<li>\(Z_i > Z_j\): subject \(i\) ranked better than subject \(j\)</li>
<li>\(Z_i=Z_j\): subjects \(i\) and \(j\) ranked the same</li>

</ul></li>
<li>Both dead 
<ul>
<li>\(L_i > L_j\): subject \(i\) ranked better than subject \(j\)</li>
<li>\(L_i=L_j\): subjects \(i\) and \(j\) ranked the same</li>

</ul></li>
<li>Alive + Dead
<ul>
<li>subject alive ranked better than subject dead</li>

</ul></li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-orge44bc21">
<div class="slide-header"></div>
<h4 id="orge44bc21">Statistical inference</h4>
<ul>
<li>Based on the parameter 
\[\theta = P(U_i < U_j) - P(U_i > U_j) \]</li>
<li>Hypothesis testing</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-org08b7e79">
<div class="slide-header"></div>
<h4 id="org08b7e79">Sensitivity analysis</h4>
<ul>
<li>Benchmark assumptions (CCMV) <i>untestable</i></li>
<li><i>Sensitivity analysis</i> essential to evaluate the robustness of
inferences to deviations from benchmark assumptions</li>
<li>Assumptions      
\[f(Y_{mis} | A_K=1,  Y_{obs}, Y_0, X, T=t,S=s)   \propto  \exp \{\beta_{t} Z\} f(Y_{mis} | A_K=1, Y_{obs}, Y_0, X, T=t, S=\mathbf{1})\]</li>

</ul>

<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org305a4c1">
<div class="slide-header"></div>
<h3 id="org305a4c1">Simulation Study</h3>
<ul>
<li>Conduct simulation study to evaluate 
<ul>
<li>if the sensitivity analysis strategy works</li>
<li>how the deaths and missing data affect the final conclusions</li>

</ul></li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org0ee5b35">
<div class="slide-header"></div>
<h3 id="org0ee5b35">Application</h3>
<ul>
<li>Apply the proposed method to a Phase III cancer drug clinical study submitted the FDA</li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org63fab03">
<div class="slide-header"></div>
<h3 id="org63fab03">Product</h3>

<div class="figure">
<p><img src="biometrics.png" alt="biometrics.png" />
</p>
</div>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org03c13af">
<div class="slide-header"></div>
<h2 id="org03c13af">Case Study: Component Software</h2>
<div class="outline-text-2" id="text-org03c13af">
</div><div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org99913ac">
<div class="slide-header"></div>
<h3 id="org99913ac">Raw code</h3>
<div class="outline-text-3" id="text-org99913ac">
</div><div class="slide-footer"></div>
</section>
<section id="slide-orgfcd735c">
<div class="slide-header"></div>
<h4 id="orgfcd735c">R code</h4>
<div class="org-src-container">

<pre><code class="R" >##table of missing pattern
get.mis.table <- function(data.all, duration, vtrt, vsurv, voutcome, trt.len=NULL) {
    a.trt    <- get.trt(data.all[,vtrt]);
    mis.pat  <- get.miss.pattern(length(voutcome));

    if (is.null(trt.len)) {
        trt.len <- paste(toupper(vtrt), "=", a.trt, sep="");
    }

    rst <- NULL;
    for (i in 1:length(a.trt)) {
        subg      <- data.all[which(a.trt[i] == data.all[,vtrt]),
                              c(vsurv, voutcome)];
        nsub      <- nrow(subg);
        cur.alive <- subg[which(subg[,vsurv] > duration),voutcome];
        n.dead    <- nsub-nrow(cur.alive);

        cur.y <- !is.na(cur.alive);
        inx.y <- table(1+get.compose(cur.y));

        n.p               <- rep(0, nrow(mis.pat));
        names(n.p)        <- rownames(mis.pat);
        n.p[names(inx.y)] <- inx.y;

        char.rst <- sapply( c(n.dead, n.p), function(x) { sprintf("%i(%5.2f%%)", x, 100*x/nsub)});
        char.rst <- c(char.rst, nsub);
        rst      <- cbind(rst, char.rst);
    }

    rst <- cbind(rbind("", mis.pat, ""), rst);
    colnames(rst) <- c(paste(voutcome, "Observed", sep=" "), trt.len);
    rownames(rst) <- c("Deaths on study",
                       paste("S=", 1:nrow(mis.pat), sep=""),
                       "Total");

    rst
}    
</code></pre>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org8063ef5">
<div class="slide-header"></div>
<h4 id="org8063ef5">C code</h4>
<div class="org-src-container">

<pre><code class="C" >//order two subjects
void rankij(double *s1, double *z1, double *s2, double *z2,
            double *duration, double *cuts, double *cutz, int *rst) {

  double tmp;

  //both alive
  if ((*s1 > *duration) &&  (*s2 > *duration)) {
    tmp = *z1 - *z2;
    if (tmp > *cutz) {
      *rst = 1;
    } else if (tmp < -*cutz) {
      *rst = -1;
    } else {
      *rst = 0;
    }
  } else if ((*s1 <= *duration) &&  (*s2 <= *duration)) {
    tmp = *s1 - *s2;
    if (tmp > *cuts) {
      *rst = 1;
    } else if (tmp < -*cuts) {
      *rst = -1;
    } else {
      *rst = 0;
    }
  } else {
    if (*s1 > *duration) {
      *rst = 1;
    } else {
      *rst = -1;
    }
  }
}
</code></pre>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org872847e">
<div class="slide-header"></div>
<h4 id="org872847e">STAN code</h4>
<div class="org-src-container">

<pre><code class="R" >data {
    int<lower=1>          NY;   //total no. y
    int<lower=0>          NOBS; //no of observed y 
    vector[NOBS+1]        YOBS; //add dummy y to handle nobs=0
    int<lower=1>          NX;   //no. covariates
    vector[NX]            X;    //covariates
    matrix[NY, NX+3]      COEF; //coefficents 1st column is sigma

    int<lower=0, upper=1> IMIS[NY];
    int<lower=1>          INX[NY];

    //residuals
    int<lower=0, upper=1> ASSUMENORMAL;
    int<lower=1>          NRES;
    matrix[NRES,NY]       RESIDUAL;
    real                  H[NY];

}

transformed data {
    int<lower = 0> NMIS;
    real MU[NY];
    real SIGMA[NY];

    NMIS = NY - NOBS;
    for (i in 1:NY) {
        SIGMA[i] = COEF[i, 1];
        MU[i]    = COEF[i, 2];
        //covariates
        for (k in 1:NX) {
            MU[i] = MU[i] + X[k] * COEF[i, 3+k];
        }
    }
}

parameters{
    vector[NMIS] YMIS;
}

model {
    YMIS ~ cond(YOBS, COEF, NY, MU, SIGMA, IMIS, INX, ASSUMENORMAL, NRES, RESIDUAL, H);
}
</code></pre>
</div>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgf67655c">
<div class="slide-header"></div>
<h3 id="orgf67655c">Difficulty</h3>
<ul>
<li>It is almost impossible to share the code with others 
<ul>
<li>No documentation</li>
<li>No guidance</li>
<li>Complicated configuration
<ul>
<li>Need to know STAN</li>

</ul></li>

</ul></li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org9084705">
<div class="slide-header"></div>
<h3 id="org9084705">R package</h3>
<ul>
<li>Re-Organize the functions</li>
<li>Add detailed documentation</li>
<li>Incorporate the C code</li>
<li>Incorporate the STAN code</li>
<li>Provide examples</li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org6d91039">
<div class="slide-header"></div>
<h3 id="org6d91039">Development</h3>
<div class="outline-text-3" id="text-org6d91039">
</div><div class="slide-footer"></div>
</section>
<section id="slide-orga8f9569">
<div class="slide-header"></div>
<h4 id="orga8f9569">Re-Organized code</h4>
<div class="org-src-container">

<pre><code class="R" >#' Treatment effect estimation
#'
#' Estimate treatment effect and median of the composite endpoint from using
#' imputed data
#'
#' @inheritParams imPlotCompleters
#' @inheritParams imPlotImputed
#'
#' @param quantiles Quantiles of the composite endpoint to be reported
#'
#' @param ... Options for ranking subjects using the composite endpoint
#' \describe{
#' \item{cut.z}{Clinically meaningful difference in the functional outcome}
#' \item{cut.surv}{Clinically meaningful difference in survival time}}
#'
#' @return A class \code{IDEM.RST} list contains
#' \describe{
#' \item{list.var}{List of parameters}
#' \item{theta}{A dataset with columns \code{Delta0}, \code{Delta1}, \eqn{\hat{\theta}}}
#' \item{quantiles}{ A dataset with columns \code{Delta}, \code{Trt}, \code{Quantiles}}
#' \item{survivor}{A dataset for survivors with columns \code{Delta0}, \code{Delta1}, \code{Mean0},
#' \code{Mean1}, \code{Diff}}}
#'
#' @examples
#' \dontrun{
#' lst.var <- list(trt="TRT", surv="SURV", outcome=c("Y1","Y2"), y0=NULL,
#'                 endp=c("Y2"), unitTime="days",
#'                 trt.label = c("UC+SBT", "SAT+SBT"),
#'                 cov=c("AGE"), endfml="Y2", duration=365, bounds=c(0,100));
#' rst.fit <- imFit(abc, lst.var);
#' rst.imp <- imImpAll(abc, rst.fit, lst.var, deltas=c(-0.25,0,0.25),
#'                     normal=TRUE, iter=300, n.imp=2, thin=10, p.scale=10);
#' rst.est <- imEstimate(rst.imp, quantiles=c(0.25,0.5,0.75));}
#'
#' @export
#'
imEstimate <- function(imp.rst,
                       quantiles=0.5,
                       ...) {

    if (is.null(imp.rst))
        return(NULL);

    stopifnot(any(class(imp.rst) == get.const("IMP.CLASS")));

    lst.var  <- imp.rst$lst.var;
    imp.data <- imp.rst$complete;
    deltas   <- imp.rst$deltas;
    n.imp    <- imp.rst$n.imp;

    vtrt     <- lst.var$trt;
    duration <- lst.var$duration;
    vsurv    <- lst.var$surv;

    ##trt arms
    atrt <- sort(unique(imp.data[, vtrt]));

    ##not imputed subjects
    sub.noimp   <- imp.data[is.na(imp.data$IMP),,drop=FALSE];
    ready.noimp <- get.data.ready(sub.noimp, lst.var, atrt);

    rst.median   <- NULL;
    rst.rank     <- NULL;
    for (i in 1:n.imp) {
        tmp.lst <- rep(list(NULL), length(deltas));
        for (j in 1:length(deltas)) {
            cur.data     <- subset(imp.data, imp.data$DELTA == deltas[j] & imp.data$IMP == i);
            cur.ready    <- get.data.ready(cur.data, lst.var, atrt);
            tmp.lst[[j]] <- rep(list(NULL), length(atrt));

            for (k in 1:length(atrt)) {
                tmp.lst[[j]][[k]] <- rbind(ready.noimp[[k]], cur.ready[[k]]);
                c.med             <- get.median(tmp.lst[[j]][[k]], duration, quantiles=quantiles, ...);
                rst.median        <- rbind(rst.median,
                                           cbind(i, deltas[j], atrt[k], c.med));
            }
        }

        for (t1 in 1:length(deltas)) {
            for (t2 in 1:length(deltas)) {
                cur.rank <- c.rankall(tmp.lst[[t1]][[1]],
                                      tmp.lst[[t2]][[2]],
                                      duration, ...);
                rst.rank <- rbind(rst.rank,
                                  c(i, deltas[t1], deltas[t2], cur.rank));
            }
        }
    }

    colnames(rst.median) <- c("Imputation", "Delta", "TRT", "Q", "QuantSurv", "QuantY");
    colnames(rst.rank)   <- c("Imputation", "Delta0", "Delta1", "Theta");

    ##median of median
    dfmedian       <- data.frame(rst.median);
    dfmedian$Quant <- get.comp(dfmedian$QuantY, dfmedian$QuantSurv, lst.var$duration);
    dfmedian       <- sqldf('select * from dfmedian order by Delta, Trt, Q, Quant');
    inx.median     <- ceiling(n.imp/2);
    median.median  <- dfmedian[seq(inx.median, nrow(dfmedian), by=n.imp),
                               c("Delta", "TRT", "Q", "QuantY", "QuantSurv")];

    inx.2 <- which(median.median$QuantSurv <= lst.var$duration);
    if (length(inx.2) > 0) {
        median.median[inx.2,  "QuantY"]    <- NA;
        median.median[-inx.2, "QuantSurv"] <- NA;
    }

    ##average rank
    dfrank  <- data.frame(rst.rank);
    avg.rank <- sqldf('select Delta0, Delta1, avg(Theta) as Theta
                       from dfrank group by Delta1, Delta0');

    ##survivor functional means
    dalive       <- imp.data[imp.data[,vsurv] > duration, , drop=FALSE];
    rst.survivor <- NULL;
    if (nrow(dalive) > 0) {
        ##there exist survivors
        endp    <- get.const("TXT.ENDP");
        txt.sql <- paste("select delta, trt, avg(endp) as Mean",
                         "from (select distinct delta, ", vtrt, " as trt, ID,",
                         "avg(", endp, ") as endp",
                         "from dalive group by delta, ID) group by delta, trt",
                         sep=" ");
        survtrt    <- sqldf(txt.sql);
        survtrt.t0 <- survtrt[seq(1, nrow(survtrt)-1, 2), c("delta", "Mean")];
        survtrt.t1 <- survtrt[seq(2, nrow(survtrt), 2), c("delta", "Mean")];
        ndelta     <- nrow(survtrt.t0);
        rst.survivor <- cbind(survtrt.t0[ rep(1:ndelta, each = ndelta),],
                              survtrt.t1[ rep(1:ndelta, ndelta),]);

        colnames(rst.survivor) <- c("Delta0", "Mean0", "Delta1", "Mean1");
        rst.survivor <- data.frame(rst.survivor);
        rst.survivor$Diff <- rst.survivor$Mean1 - rst.survivor$Mean0;
    }

    rst <- list(lst.var=lst.var,
                quantiles=median.median,
                theta=avg.rank,
                survivor=rst.survivor,
                raw.theta=rst.rank,
                raw.quantiles=rst.median);

    class(rst) <- get.const("RST.CLASS");
    rst
}


</code></pre>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-orge44361d">
<div class="slide-header"></div>
<h4 id="orge44361d">Incorporate external code</h4>

<div class="figure">
<p><img src="rpkg_src.png" alt="rpkg_src.png" />
</p>
</div>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgae56faf">
<div class="slide-header"></div>
<h3 id="orgae56faf">Final Product</h3>
<ul>
<li>A single <code>tar</code> file</li>
<li>Can be download and installed from online for 
<ul>
<li>32-bit Windows</li>
<li>64-bit Windows</li>
<li>Mac OS</li>
<li>Unix</li>

</ul></li>
<li>With detailed <a href="idem.pdf">help file</a></li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orge2df212">
<div class="slide-header"></div>
<h3 id="orge2df212">Script Mode Demo</h3>
<div class="org-src-container">

<pre><code class="R" >install.packages("idem");
require(idem);
head(abc);
help("idem-parameters", package=idem);
lst.var <- list(trt = "TRT", surv = "SURV", outcome = c("Y1","Y2"),
                y0 = NULL, endp = c("Y2"), unitTime = "days",
                trt.label = c("UC+SBT", "SAT+SBT"), cov = c("AGE"), endfml = "Y2",
                duration = 365, bounds = c(0,100));
is.null(imChkPars(abc, lst.var));
imMisTable(abc, lst.var);
imPlotCompleters(abc, lst.var);
imPlotMisPattern(abc, lst.var);
imPlotSurv(abc, lst.var);
rst.fit <- imFitModel(data.all = abc, lst.var = lst.var);
rst.mixing <- imImpSingle(abc[1,], rst.fit,
                          chains = 4, iter = 2000, warmup = 1000);
rst.imp <- imImpAll(abc, rst.fit, deltas = seq(-0.2,0.2,0.05),
                    n.imp = 5, normal = TRUE, chains = 4, iter = 5000, warmup = 1000);
</code></pre>
</div>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgdf36675">
<div class="slide-header"></div>
<h3 id="orgdf36675">Question</h3>
<ul>
<li>Is this enough?</li>
<li>What about users who do not know R?</li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org54b1807">
<div class="slide-header"></div>
<h2 id="org54b1807">Case Study: User-Friendly Software</h2>
<div class="outline-text-2" id="text-org54b1807">
</div><div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgd53f78e">
<div class="slide-header"></div>
<h3 id="orgd53f78e">Graphical User Interface</h3>
<ul>
<li>Many options</li>
<li>Web-Based GUI is platform independent</li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgf62e646">
<div class="slide-header"></div>
<h3 id="orgf62e646">Shiny</h3>
<ul>
<li>Allows statisticians to develop web pages without knowledge of HTML, Java
Script, CSS, etc.</li>
<li>Allows to fully use existing statistical code</li>
<li>Optimized for computation efficiency</li>
<li>Ideal for interactive applications</li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org841306f">
<div class="slide-header"></div>
<h3 id="org841306f">Plan</h3>
<ul>
<li>Build a web application based on the component software</li>
<li>Develop web pages and server files</li>
<li>Deploy the application on web</li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org428b6aa">
<div class="slide-header"></div>
<h3 id="org428b6aa">Web Pages</h3>
<div class="org-src-container">

<pre><code class="R" >list(
    msg.box("On this page, you will specify inputs for the imputation and estimation procedures."),
    wellPanel(h4("General Imputation Settings"),
              fluidRow(
                  column(3,
                         h6("Number of imputed datasets"),
                         sliderInput("inNImp", label = "", value=10, min=1, max=20, step=1),
                         h6("Normality assumption"),
                         radioButtons(inputId="inNorm", label="", c("Yes"=1, "No"=0))
                         ),
                  column(3,
                         h6("Number of bootstrap samples"),
                         sliderInput(inputId = "inNbs", label = "",
                                     value = 100, min = 5, max = 1000, step=1),
                         h6("Random seed"),
                         numericInput(inputId="inSeed", label="", value=0, min=0)),
                  column(3,
                         h6("Number of Cores (Parallel Bootstrap)"),
                         sliderInput("inNcores", label = "", value = 1, min = 1,
                                     max = (parallel::detectCores()-1), step = 1))
              )),
    wellPanel(
        h4("MCMC Paramters"),
        msg.box("Specify parameters for Bayesian posterior sampling. The target metropolis
                      acceptance rate and initial step-size are options for advanced users to
                      control STAN sampler's behavior. "),
        fluidRow(
            column(3,
                   h6("Number of iterations"),
                   sliderInput(inputId = "mcmciter", label = "",
                               value = 2000, min = 200, max = 20000, step=100),
                   h6("Number of burn-in"),
                   sliderInput("mcmcburnin", label = "", value=1000, min=100, max=20000, step=100)
                   ),
            column(3,
                   h6("Number of thinning"),
                   sliderInput(inputId = "mcmcthin", label = "", value=2, min=1, max=50, step=1),
                   h6("Number of chains"),
                   sliderInput("mcmcchain", label = "", value=4, min=2, max=10, step=1)
                   ),
            column(3,
                   h6("Target Metropolis Acceptance Rate"),
                   sliderInput("mcmcdelta", label = "", value=0.95, min=0.05, max=1, step=0.05),
                   h6("Initial Step-size"),
                   sliderInput("mcmcstepsize", label = "", value=1, min=0.05, max=5, step=0.05)
                   ##h6("Algorithm"),
                   ##radioButtons('mcmcalg', '', c('NUTS', 'HMC', "Fixed_param"))
                   ))),
    wellPanel(h4("Sensitivity Parameters and Additional Quantile Output"),
              fluidRow(
                  column(3,
                         h6("Imputation sensitivity parameters (separate by comma).
                              Default values set such that the range of the sensitivity
                              parameters is equal to one-fourth standard deviation of
                              the distriubtion of functional endpoints among subjects
                              who do not require their data to be imputed."),
                         textInput("inSensp", label="", value = get.sd.endp(outVar='ImpSens'))),
                  column(3,
                         h6("The median of the composite endpoint for each treatment
                              will be computed. Below enter additional percentiles of
                              the composite variable you would like to obtain."),
                         textInput("inExtras", label="", value=c("25,75"))),
                  column(3,
                         h6('SACE Sensitivity Parameter (separate by comma,
                              values <= 0 are valid). Default values set such that
                              the range of the sensitivity parameter ranges from 0 to
                              minus one-half standard deviation of the distribution of
                              functional endpoints among subjects who do not require
                              their data to be imputed.'),
                         textInput("inSACE", label="", value=get.sd.endp(outVar='SACE')))
              )),
    wellPanel(
        h4("Convergence Checking"),
        msg.box("Randomly select a subject and check the MCMC sampling convergence"),
        actionButton("btnConverge", "Check Convergence", style="info"),
        uiOutput('uiImpConv')
    )
);

</code></pre>
</div>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org747c13b">
<div class="slide-header"></div>
<h3 id="org747c13b">Server files</h3>
<div class="org-src-container">

<pre><code class="R" >output$outTblBootQuantiles <- renderTable({
    if (0 == input$btnBoot)
        return(NULL);
    rst <- get.rst.overall();

    rst$quantiles;

}, include.rownames=TRUE,
caption = 'Table: Quantiles of Compositve Variable',
caption.placement = getOption("xtable.caption.placement", "top"),
caption.width = getOption("xtable.caption.width", NULL));

## Contour plots
output$outBootContourRank <- renderPlot({
    if (0 == input$btnBoot)
        return(NULL);
    rst <- get.rst.overall();
    imPlotContour(rst, plot.title="");
},
width=500,
height=500,
bg="transparent");

##--------------------------------------
##----------Report----------------------
##--------------------------------------
output$uiReport <- renderUI({
    if (is.null(get.data())) {
        msg.box("Please upload data first.", "warning");
    } else if (-1 == userLog$model) {
        msg.box("Please validate model first.", "warning");
    } else {
        wellPanel(h4('Download the analysis report'),
                  radioButtons('format', '', c('PDF', 'HTML', 'Word')),
                  downloadButton('btnDload'))
    }
})

output$btnDload <- downloadHandler(
    filename=function() {
    paste('report_',
          format(Sys.time(), "%m%d%Y%H%M%S"),
          '.',
          switch(input$format,
                 PDF = 'pdf',
                 HTML = 'html',
                 Word = 'docx'
                 ),
          sep="")
},

content=function(file) {
    out <- rmarkdown::render('report/report.Rmd',
                             switch(input$format,
                                    PDF  = rmarkdown::pdf_document(),
                                    HTML = rmarkdown::html_document(),
                                    Word = rmarkdown::word_document()
                                    ));

    bytes <- readBin(out, "raw", file.info(out)$size);
    writeBin(bytes, file);
})

</code></pre>
</div>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org3bd6aef">
<div class="slide-header"></div>
<h3 id="org3bd6aef">Demo</h3>
<ul>
<li><a href="https://olssol.shinyapps.io/idem/">https://olssol.shinyapps.io/idem/</a></li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org4d2d58a">
<div class="slide-header"></div>
<h3 id="org4d2d58a">Appendix</h3>
<ul>
<li>Demo of a spatial software <a href="http://olssol2.shinyapps.io/icemr">http://olssol2.shinyapps.io/icemr</a></li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org9e544a7">
<div class="slide-header"></div>
<h2 id="org9e544a7">Scientific Software</h2>
<div class="outline-text-2" id="text-org9e544a7">
</div><div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org72c73a2">
<div class="slide-header"></div>
<h3 id="org72c73a2">Overall Scheme</h3>
<div class="outline-text-3" id="text-org72c73a2">
</div><div class="slide-footer"></div>
</section>
<section id="slide-org289f573">
<div class="slide-header"></div>
<h4 id="org289f573"></h4>

<div class="figure">
<p><img src="sgsc.png" alt="sgsc.png" />
</p>
</div>
<div class="slide-footer"></div>
</section>
<section id="slide-org2bb2f20">
<div class="slide-header"></div>
<h4 id="org2bb2f20"></h4>
<ul>
<li>Your work
<ul>
<li>Built upon many existing scientific work (e.g. theories, experiments)</li>

</ul></li>
<li>Component software 
<ul>
<li>May incorporate many other component software packages</li>

</ul></li>
<li>User friendly software 
<ul>
<li>Supported by powerful server system</li>

</ul></li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org2ce9305">
<div class="slide-header"></div>
<h3 id="org2ce9305">Our Tasks</h3>
<div class="outline-text-3" id="text-org2ce9305">
</div><div class="slide-footer"></div>
</section>
<section id="slide-orga5fb1a1">
<div class="slide-header"></div>
<h4 id="orga5fb1a1">Synthesize and develop code</h4>
<ul>
<li>R</li>
<li>C/C++</li>
<li>Python</li>
<li>SAS</li>
<li>Shell script</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-org5668c01">
<div class="slide-header"></div>
<h4 id="org5668c01">Develop Web Gateway Portal</h4>
<ul>
<li>Shiny+R (Data visualization)</li>
<li>Airavata (Data computing)</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-org3bc8287">
<div class="slide-header"></div>
<h4 id="org3bc8287">Develop front-end software</h4>
<ul>
<li>Web application</li>
<li>Stand-alone application</li>
<li>Mobile application</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-orgbb85859">
<div class="slide-header"></div>
<h4 id="orgbb85859">High-Performance computing</h4>
<ul>
<li>Multi-core Parallel</li>
<li>GPU</li>
<li>XEON PHI</li>
<li>Cloud computation</li>

</ul>
<div class="slide-footer"></div>
</section>
<section id="slide-orgf1b9145">
<div class="slide-header"></div>
<h4 id="orgf1b9145">Machine learning</h4>
<ul>
<li>Bayesian non-parametric</li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgec5632d">
<div class="slide-header"></div>
<h2 id="orgec5632d">Summary</h2>
<div class="outline-text-2" id="text-orgec5632d">
</div><div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-orgee551bb">
<div class="slide-header"></div>
<h3 id="orgee551bb">Why do we need scientific software?</h3>
<ul>
<li>Necessary to deliver the work to people</li>
<li>Allow scientists to focus on the real work</li>
<li>Reproducible research</li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
<section>
<section id="slide-org0fd845d">
<div class="slide-header"></div>
<h3 id="org0fd845d">Our Goal</h3>
<ul>
<li>Imagine there is a day
<ul>
<li>your idea can be easily implemented with a user-friendly interface on a
cloud-based computing platform to utilize their latest CPU/GPU and parallel software programming technology</li>
<li>Your data, should it be tables, medical images, or real-time photos, can
be easily shared with other scientists</li>
<li>Just a couple of clicks, your work is delivered to people, ordinary
people, seamlessly.</li>

</ul></li>
<li>We are here to make it happen.</li>

</ul>
<div class="slide-footer"></div>
</section>
</section>
</div>
</div>
<script src="https://cdn.jsdelivr.net/reveal.js/3.0.0/lib/js/head.min.js"></script>
<script src="https://cdn.jsdelivr.net/reveal.js/3.0.0/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c/t',
rollingLinks: true,
keyboard: true,
overview: true,
margin: 0.10,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'convex', // default/cube/page/concave/zoom/linear/fade/none
transitionSpeed: 'default',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: 'https://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
 { src: 'https://cdn.jsdelivr.net/reveal.js/3.0.0/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }]
});
</script>
</body>
</html>
